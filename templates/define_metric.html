<!-- templates/define_metric.html -->
<!DOCTYPE html>
<html>

<head>
    <title>Define Metric</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Pass the columns data to JavaScript
        var columns = {{ columns | tojson }};
        $(document).ready(function () {
            $('#metric_type').change(function () {
                if ($(this).val() == 'single') {
                    $('#single_metric').show();
                    $('#dual_metric').hide();
                } else if ($(this).val() == 'dual') {
                    $('#single_metric').hide();
                    $('#dual_metric').show();
                } else {
                    $('#single_metric').hide();
                    $('#dual_metric').hide();
                }
            });

            $('#add_single_filter').click(function () {
                addFilter('single_filters', 'single');
            });

            $('#add_dual_filter').click(function () {
                addFilter('dual_filters', 'dual');
            });

            function addFilter(divId, prefix) {
                var columnOptions = '';
                for (var i = 0; i < columns.length; i++) {
                    columnOptions += '<option value="' + columns[i] + '">' + columns[i] + '</option>';
                }
                var newFilter = `
                <div class="filter">
                    <label>Filter Column:</label>
                    <select name="` + prefix + `_filter_column[]">
                        <option value="">Select Column</option>
                        ` + columnOptions + `
                    </select>
                    <label>Operator:</label>
                    <select name="` + prefix + `_filter_operator[]">
                        <option value="EQ">Equals</option>
                        <option value="NEQ">Not Equals</option>
                        <option value="GT">Greater Than</option>
                        <option value="LT">Less Than</option>
                    </select>
                    <label>Value:</label>
                    <input type="text" name="` + prefix + `_filter_value[]" placeholder="Value">
                    <br><br>
                </div>
                `;
                $('#' + divId).append(newFilter);
            }
        });
    </script>
</head>

<body>
    <h1>Define a Metric</h1>
    <form method="post">
        <label for="metric_type">Metric Type:</label>
        <select id="metric_type" name="metric_type" required>
            <option value="">Select Metric Type</option>
            <option value="single">Single Column Metric</option>
            <option value="dual">Dual Column Metric</option>
        </select>
        <br><br>
        <label for="metric_name">Metric Name:</label>
        <input type="text" id="metric_name" name="metric_name" required>
        <br><br>

        <!-- Single Column Metric Form -->
        <div id="single_metric" style="display: none;">
            <h2>Single Column Metric Details</h2>
            <label for="column">Column:</label>
            <select id="column" name="column" required>
                <option value="">Select Column</option>
                {% for col in columns %}
                <option value="{{ col }}">{{ col }}</option>
                {% endfor %}
            </select>
            <br><br>
            <label for="date_column">Date Column:</label>
            <select id="date_column" name="date_column" required>
                <option value="">Select Date Column</option>
                {% for col in columns %}
                <option value="{{ col }}">{{ col }}</option>
                {% endfor %}
            </select>
            <br><br>
            <label for="aggregation_method">Aggregation Method:</label>
            <select id="aggregation_method" name="aggregation_method" required>
                <option value="sum">Sum</option>
                <option value="mean">Mean</option>
                <option value="count">Count</option>
            </select>
            <br><br>
            <h3>Filters</h3>
            <div id="single_filters">
                <!-- Filters will be added here -->
            </div>
            <button type="button" id="add_single_filter">Add Filter</button>
            <br><br>
        </div>

        <!-- Dual Column Metric Form -->
        <div id="dual_metric" style="display: none;">
            <h2>Dual Column Metric Details</h2>
            <h3>Numerator Metric</h3>
            <!-- Numerator fields -->
            <!-- ... similar to single metric fields ... -->
            <br><br>

            <h3>Denominator Metric</h3>
            <!-- Denominator fields -->
            <!-- ... similar to single metric fields ... -->
            <br><br>

            <label for="combine_method">Combine Method:</label>
            <select id="combine_method" name="combine_method" required>
                <option value="1">Divide</option>
            </select>
            <br><br>
            <h3>Filters</h3>
            <div id="dual_filters">
                <!-- Filters will be added here -->
            </div>
            <button type="button" id="add_dual_filter">Add Filter</button>
            <br><br>
        </div>

        <input type="submit" value="Submit">
    </form>
</body>

</html>